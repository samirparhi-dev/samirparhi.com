<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>samirparhi.com</title>
        <meta name="description" content="Blog Site of Samir Parhi">
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="theme-color" content="#ffffff">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="icon" href="https://samirparhi.com/img/brand/fv.png">
        <link href="https://fonts.googleapis.com/css2?family=Work+Sans&family=Manrope&family=IBM+Plex+Sans&family=Funnel+Display&family=Syne+Mono&display=swap" rel="stylesheet">
        <!-- Stylesheets -->
        <link rel="stylesheet" href="https://samirparhi.com/styles/styles.css" />
    </head>
<body class="min-h-40">
    <header class="w-full from-purple-100 via-sky-100 to-rose-100 bg-gradient-to-r backdrop-blur-lg shadow-lg bg-opacity-10">
        <div class="container mx-auto rounded-lg ml-15 px-15 flex justify-between flex-wrap">
            <!-- Fixed-size, non-wrapping text -->
            <div class="cursor-pointer">
                <div class="px-5">
                    <ul class="flex px-2">
                        <a href="/#">
                            
                            
                            
    
                            <ul class="flex">
                                <a href="/#">
                                    
                                    
                                    
            
                                    
            
                                    <img src="https:&#x2F;&#x2F;samirparhi.com&#x2F;processed_images&#x2F;samirparhi-logo.b634d9429bb5a861.png" srcset="/img&#x2F;brand&#x2F;samirparhi-logo.png 2x"/>
                                
                                </a>
                            </ul>
                        </a>
                    </ul>
            </div>
            
            <!-- Menu that wraps below the name on smaller screens -->
            <div class="list-none px-5 mx-5 flex flex-wrap justify-center lg:justify-end space-x-5 lg:text-xl sm:text-xs md:text-sm mt-4 lg:mt-0">
                
                <li class=" hover:text-violet-900 text-fuchsia-800 font-light rounded-lg p-2 font-mono py-5">
                    <a href="https:&#x2F;&#x2F;samirparhi.com&#x2F;#">Home</a>
                </li>
                
                <li class=" hover:text-violet-900 text-fuchsia-800 font-light rounded-lg p-2 font-mono py-5">
                    <a href="https:&#x2F;&#x2F;samirparhi.com&#x2F;about">About</a>
                </li>
                
                <li class=" hover:text-violet-900 text-fuchsia-800 font-light rounded-lg p-2 font-mono py-5">
                    <a href="https:&#x2F;&#x2F;samirparhi.com&#x2F;collab">Collaboration</a>
                </li>
                
                <li class=" hover:text-violet-900 text-fuchsia-800 font-light rounded-lg p-2 font-mono py-5">
                    <a href="https:&#x2F;&#x2F;samirparhi.com&#x2F;connect">Connect</a>
                </li>
                
            </div>
        </div>
        
    </header>
    <!-- <div class="w-full h-1 bg-gradient-to-r from-purple-500 via-sky-600 to-rose-400 backdrop-blur-lg shadow-lg bg-opacity-10"></div> -->
    


    <div class="container mx-auto py-10 flex-col-reverse  ">
      <p class="text-4xl text-center py-10 text-sky-600">
        Building a Dynamic Data Pipeline from Scratch with Snowflake and Python
      </p>

      <div class="flex container flex-wrap text-lg justify-center px-10 py-1 space-x-5 md:text-sm lg:text-xl">
        <div class="flex flex-wrap">
        <p class="text-violet-950 font-bold">Author:</p>
        <p class="text-red-800">
          <a href="/about">Samir Ranjan Parhi</a>
        </p>
        </div>
        <div class="flex flex-wrap">
        <p class="text-violet-950 font-bold">Date:</p>
        <p class="text-red-800">
          12 April 2024
        </p>
      </div>
      <div class="flex flex-wrap">
        <p class="text-violet-950 font-bold">Word Count:</p>
        <p class="text-red-800">319</p>
      </div>
      <div class="flex flex-wrap">
        <p class="text-violet-950 font-bold">Estimated Read Time:</p>
        <p class="text-red-800">2 minutes</p>
      </div>
    </div>

  </div>

    <div class=" container py-5 mx-auto rounded-lg ml-15 px-15 flex justify-between flex-wrap">

      <article class=" container text-purple-700 overflow-hidden prose mx-auto p-5 text-justify text-wrap md:text-3xl lg:text-2xl text-sm ">
        <h3 id="the-problem-statement">The problem statement</h3>
<p>Sells 44 is an E-comerce platform which need some user data for it campaign. you are hence asked to extracts sales data from Snowflake, performs transformation using Pandas and NumPy (e.g., handling missing values and aggregating sales by region), and then saves the final output back to Snowflake or to a CSV for further analysis.</p>
<h3 id="system-design">System Design</h3>
<h4 id="1-components">1. Components</h4>
<ul>
<li><em>Snowflake:</em> The cloud-based data warehouse where the raw sales data is stored.</li>
<li>Python: The programming language used for data pipeline orchestration.</li>
<li>Snowflake Connector for Python: This allows seamless interaction with Snowflake to extract and load data.</li>
<li>Pandas: Used for data manipulation, cleaning, and transformation.</li>
<li>NumPy: Used for numerical operations and advanced calculations.</li>
<li>CSV Output or Data Persistence: The final transformed data can be written back to Snowflake or exported as a CSV for external use.</li>
</ul>
<h4 id="2-flow-the-etl">2. Flow (The ETL)</h4>
<ul>
<li>Extract: Fetch raw sales data from Snowflake.</li>
<li>Transform: Clean the data using Pandas (handle missing values, filter, group, and calculate). Use NumPy for any complex numerical operations.</li>
<li>Load: Save the transformed data either back into Snowflake or export as a CSV for further reporting.</li>
<li>Establish a Snowflake Connection: Connects to Snowflake using your credentials and account information.</li>
<li>Extract: Runs a SQL query to fetch sales data.</li>
<li>Pandas Transformation:
<ul>
<li>Missing Values: Fills missing values in the sales_amount column with the mean.</li>
<li>NumPy Transformation: Applies a log transformation to scale the sales data using NumPy.</li>
<li>Aggregation: Groups the data by region and aggregates the total sales.</li>
<li>Load: Saves the transformed data to a CSV file or writes it back to Snowflake.</li>
</ul>
</li>
</ul>
<h3 id="lets-code-it">Lets Code it</h3>
<ol>
<li>Setup the Snowflake Connector
You’ll need to install the Snowflake connector and Pandas library:</li>
</ol>
<p><code>pip install snowflake-connector-python pandas numpy</code></p>
<ol start="2">
<li>Code for the Data Pipeline:</li>
</ol>
<pre style="background-color:#212121;color:#eeffff;"><code><span>import snowflake.connector
</span><span>import pandas as pd
</span><span>import numpy as np
</span><span>
</span><span># Step 1: Establish connection to Snowflake
</span><span>conn = snowflake.connector.connect(
</span><span>    user=&#39;your_username&#39;,
</span><span>    password=&#39;your_password&#39;,
</span><span>    account=&#39;your_account_url&#39;
</span><span>)
</span><span>
</span><span># Step 2: Query Snowflake to extract data
</span><span>query = &quot;&quot;&quot;
</span><span>SELECT region, sales_amount, sales_date
</span><span>FROM sales_data
</span><span>WHERE sales_date &gt;= &#39;2024-01-01&#39;
</span><span>&quot;&quot;&quot;
</span><span>
</span><span># Step 3: Execute the query and fetch data
</span><span>cur = conn.cursor()
</span><span>cur.execute(query)
</span><span>data = cur.fetchall()
</span><span>
</span><span># Step 4: Load the data into a Pandas DataFrame
</span><span>columns = [&#39;region&#39;, &#39;sales_amount&#39;, &#39;sales_date&#39;]
</span><span>df = pd.DataFrame(data, columns=columns)
</span><span>
</span><span># Step 5: Data Cleaning and Transformation
</span><span># Fill missing values in the &#39;sales_amount&#39; column with the mean
</span><span>df[&#39;sales_amount&#39;].fillna(df[&#39;sales_amount&#39;].mean(), inplace=True)
</span><span>
</span><span># Use NumPy to apply advanced numerical transformations (e.g., scaling)
</span><span>df[&#39;scaled_sales&#39;] = np.log(df[&#39;sales_amount&#39;] + 1)
</span><span>
</span><span># Aggregate sales by region
</span><span>aggregated_data = df.groupby(&#39;region&#39;)[&#39;sales_amount&#39;].sum().reset_index()
</span><span>
</span><span># Step 6: Save the transformed data back to Snowflake or to a CSV
</span><span># Save to CSV
</span><span>aggregated_data.to_csv(&#39;aggregated_sales_data.csv&#39;, index=False)
</span><span>
</span><span># Alternatively, you can write the data back to Snowflake:
</span><span># cur.execute(&quot;CREATE OR REPLACE TABLE transformed_sales_data (region STRING, total_sales FLOAT)&quot;)
</span><span># for index, row in aggregated_data.iterrows():
</span><span>#     cur.execute(f&quot;INSERT INTO transformed_sales_data (region, total_sales) VALUES (&#39;{row[&#39;region&#39;]}&#39;, {row[&#39;sales_amount&#39;]})&quot;)
</span><span>
</span><span># Close the cursor and connection
</span><span>cur.close()
</span><span>conn.close()
</span><span>
</span><span>print(&quot;Data pipeline completed successfully!&quot;)
</span></code></pre>
<h3 id="scalability">Scalability:</h3>
<p>The architecture allows easy scaling as Snowflake handles large datasets efficiently.
Python’s flexibility enables more complex transformations if needed.</p>
<h3 id="deployment-considerations">Deployment Considerations:</h3>
<p>The pipeline can be scheduled using Jenkins jobs or GitHub Action</p>
<pre style="background-color:#212121;color:#eeffff;"><code><span>name: Snowflake Pipeline Schedule
</span><span>
</span><span># Schedule to run daily at 12:00 AM (UTC)
</span><span>on:
</span><span>  schedule:
</span><span>    - cron: &#39;0 0 * * *&#39;
</span><span>
</span><span>  workflow_dispatch: # Allows manual trigger
</span><span>
</span><span>jobs:
</span><span>  run-snowflake-pipeline:
</span><span>    runs-on: ubuntu-latest
</span><span>
</span><span>    steps:
</span><span>    # Step 1: Checkout the repository code
</span><span>    - name: Checkout code
</span><span>      uses: actions/checkout@v3
</span><span>
</span><span>    # Step 2: Set up Python environment
</span><span>    - name: Set up Python 3.x
</span><span>      uses: actions/setup-python@v4
</span><span>      with:
</span><span>        python-version: &#39;3.x&#39;
</span><span>
</span><span>    # Step 3: Install dependencies
</span><span>    - name: Install dependencies
</span><span>      run: |
</span><span>        python -m pip install --upgrade pip
</span><span>        pip install snowflake-connector-python pandas numpy
</span><span>
</span><span>    # Step 4: Run the Snowflake pipeline
</span><span>    - name: Run Snowflake Data Pipeline
</span><span>      env:
</span><span>        SNOWFLAKE_USER: ${{ secrets.SNOWFLAKE_USER }}
</span><span>        SNOWFLAKE_PASSWORD: ${{ secrets.SNOWFLAKE_PASSWORD }}
</span><span>        SNOWFLAKE_ACCOUNT: ${{ secrets.SNOWFLAKE_ACCOUNT }}
</span><span>      run: |
</span><span>        python snowflake_pipeline.py
</span></code></pre>

          
        </article>
        
          <div class=" flex mx-auto text-center flex-wrap p-4 justify-center">
            
            <p class="text-fuchsia-800 flex flex-wrap"> Tags 🔖 :
              
              <a href="https://samirparhi.com/tags/datapipeline/" class="text-sky-700 flex hover:underline mx-2">
                #DataPipeline 
              </a>
              
              <a href="https://samirparhi.com/tags/python/" class="text-sky-700 flex hover:underline mx-2">
                #python 
              </a>
              
              <a href="https://samirparhi.com/tags/snowflake/" class="text-sky-700 flex hover:underline mx-2">
                #snowflake 
              </a>
              
            </p>
          </div>
          


    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
          // Select all code blocks
          const codeBlocks = document.querySelectorAll("pre");
    
          codeBlocks.forEach((block, index) => {
              // Create a copy button
              const copyButton = document.createElement("button");
              copyButton.innerText = "Copy";
              copyButton.classList.add("copy-btn", "bg-fuchsia-700", "text-white", "px-3", "py-1", "rounded-lg", "hover:bg-fuchsia-900", "absolute", "top-2", "right-2", "text-xs");
    
              // Add event listener to handle copying
              copyButton.addEventListener("click", () => {
                  const codeText = block.innerText;
                  navigator.clipboard.writeText(codeText).then(() => {
                      copyButton.innerText = "Copied!";
                      setTimeout(() => {
                          copyButton.innerText = "Copy";
                      }, 2000);
                  });
              });
    
              // Wrap the code block in a relative container and add the button
              const wrapper = document.createElement("div");
              wrapper.classList.add("relative", "code-block-wrapper", "mb-6");
              wrapper.appendChild(block.cloneNode(true));
              wrapper.appendChild(copyButton);
    
              block.replaceWith(wrapper);
          });
      });
    </script>

 

    <div class="w-full h-2 bg-gradient-to-l from-purple-500 via-sky-600 to-rose-400 backdrop-blur-lg shadow-lg bg-opacity-10"></div> 
    <footer class="py-4 from-cyan-100 to-rose-50 bg-gradient-to-l backdrop-blur-md">

            <ul class="px-5 list-none flex flex-wrap justify-evenly space-x-2 py-2 mx-auto rounded-xl">
                
                <li class="text-xl flex-wrap text-purple-700 justify-evenly hover:underline border-1 hover:text-indigo-600 flex rounded-lg border-fuchsia-900">
                    <a href="https:&#x2F;&#x2F;github.com&#x2F;samirparhi-dev"> GitHub</a>
                </li>
                
                <li class="text-xl flex-wrap text-purple-700 justify-evenly hover:underline border-1 hover:text-indigo-600 flex rounded-lg border-fuchsia-900">
                    <a href="https:&#x2F;&#x2F;linkedin.com&#x2F;in&#x2F;samir-parhi"> LinkedIn</a>
                </li>
                
                <li class="text-xl flex-wrap text-purple-700 justify-evenly hover:underline border-1 hover:text-indigo-600 flex rounded-lg border-fuchsia-900">
                    <a href="https:&#x2F;&#x2F;twitter.com&#x2F;samirparhi"> X (Twitter)</a>
                </li>
                
                <li class="text-xl flex-wrap text-purple-700 justify-evenly hover:underline border-1 hover:text-indigo-600 flex rounded-lg border-fuchsia-900">
                    <a href="mailto:samirparhi@gmail.com"> E-Mail</a>
                </li>
                
                <li class="text-xl flex-wrap text-purple-700 justify-evenly hover:underline border-1 hover:text-indigo-600 flex rounded-lg border-fuchsia-900">
                    <a href="https:&#x2F;&#x2F;mastodon.social&#x2F;@samirparhi"> Mastodon</a>
                </li>
                
            </ul>
        
        <div class="flex py-5 text-purple-700 justify-center text-xl">
            <p>© samirparhi.com 2024</p>
        </div>
        <div class="flex py-5 text-purple-700 justify-center text-xl">
            <p>Coded 💙 by samirparhi-dev</p>
        </div>
    </footer>
</body>
</html>
